{% extends "wordofmouth/base.html" %} {% block content %} {% load static %}
{%load socialaccount %} {% csrf_token %}

<!--
  REFERENCES
  Title: Bootstrap Buttons
  Author: BTSTRPIOUS
  URL: https://bootstrapious.com/p/bootstrap-buttons

  Title: Dynamic Rows Loading
  Author: nix1947
  URL: https://gist.github.com/nix1947/c765513702e76b5b665d146a72307946

-->


<head>
  <style>
    .star-ratings {
      max-height: 18px;
    }
    button {
      background-color: transparent;
      border: none;
    }
    .star {
      opacity: 0.4;
      height: 18px;
    }
    .star:hover {
      opacity: 1;
    }
    .rating-desc {
      font-size: 1rem;
    }
    .rating-prompt {
      font-size: 12px;
      color: #ccc;
      margin-bottom: 0px;
    }
    .rating-form button {
      padding-left: 0px;
      padding-right: 0;
    }
  </style>
</head>

<body>
  <h1 class="display-4" style="text-align: center">{{recipe.title}}</h1>
  <p class="lead" style="text-align: center; margin-bottom: 0">by {{recipe.added_by}}</p>
<div style="text-align: center; font-size: 1rem">
  {%if recipe.average_rating > 4.5 %}
  <img
    class="star-ratings"
    src="{% static 'wordofmouth/images/avg-5s.png' %}"
    alt="My image"
  />
  <i class="lead rating-desc" style="margin-left: 10px"> ({{recipe.average_rating}}, {{recipe.ratings.count}} {%if recipe.ratings.count is 1%} rating{%else%} ratings{%endif%})</i>
  {% elif recipe.average_rating > 3.5 %}
  <img
    class="star-ratings"
    src="{% static 'wordofmouth/images/avg-4s.png' %}"
    alt="My image"
  />
  <i class="lead rating-desc" style="margin-left: 10px"> ({{recipe.average_rating}}, {{recipe.ratings.count}} {%if recipe.ratings.count is 1%} rating{%else%} ratings{%endif%})</i>
  {% elif recipe.average_rating > 2.5 %}
  <img
    class="star-ratings"
    src="{% static 'wordofmouth/images/avg-3s.png' %}"
    alt="My image"
  />
  <i class="lead rating-desc" style="margin-left: 10px"> ({{recipe.average_rating}}, {{recipe.ratings.count}} {%if recipe.ratings.count is 1%} rating{%else%} ratings{%endif%})</i>
  {% elif recipe.average_rating > 1.5 %}
  <img
    class="star-ratings"
    src="{% static 'wordofmouth/images/avg-2s.png' %}"
    alt="My image"
  />
  <i class="lead rating-desc" style="margin-left: 10px"> ({{recipe.average_rating}}, {{recipe.ratings.count}} {%if recipe.ratings.count is 1%} rating{%else%} ratings{%endif%})</i>

  {% elif recipe.average_rating > 0.0 %}
  <img
    class="star-ratings"
    src="{% static 'wordofmouth/images/avg-1s.png' %}"
    alt="My image"
  />
  <i class="lead rating-desc" style="margin-left: 10px"> ({{recipe.average_rating}}, {{recipe.ratings.count}} {%if recipe.ratings.count is 1%} rating{%else%} ratings{%endif%})</i>
  {% else %}
  <i class="lead rating-desc" style="color: #ccc">No Ratings</i>
  {% endif %}
</div>
  <div style="align-items: center;text-align: center">
    <img
      src="{{ recipe.image_url }}"
      alt="{{ recipe.image_url }}"
      height="200"
      style="padding: 10px; border: 1px solid #f5f5f5"
    />
      
  </div>

  <div style="align-items: center; text-align: center; font-size: 12px">
    {% if rated %}
    <p class="lead rating-prompt">Your Rating: {{ rating }}</p>
    {% else %}
    <p class="lead rating-prompt">Rate this recipe:</p>
    <!-- Rating Buttons -->
    <form class="rating-form" action="{% url 'rate_recipe' recipe.id %}" method="POST">
      {% csrf_token %} {% if user.is_authenticated %}
      {% if not rated%}
      <button type="submit" , name="rating" , value="1">
        <img class="star star1" id="star1" src="{% static 'wordofmouth/images/star-filled.png' %}" />
      </button>
      <button type="submit" , name="rating" , value="2">
        <img class="star star2" id="star2" src="{% static 'wordofmouth/images/star-filled.png' %}" />
      </button>
      <button type="submit" , name="rating" , value="3">
        <img class="star star3" src="{% static 'wordofmouth/images/star-filled.png' %}" />
      </button>
      <button type="submit" , name="rating" , value="4">
        <img class="star star4" src="{% static 'wordofmouth/images/star-filled.png' %}" />
      </button>
      <button type="submit" , name="rating" , value="5">
        <img class="star star5" src="{% static 'wordofmouth/images/star-filled.png' %}" />
      </button>
      {% endif %}{% endif %}
    </form>
    {% endif %}
  
  </div>



  <br />
  <div style="text-align: center"></div>
  <br />
  {% if error_message %}
  <p><strong>{{ error_message }}</strong></p>
  {% endif %}
  <div>

    <div style="display: flex">
      <p class="lead" style="color: #ccc">Ingredients:</p>
      <p class="lead" style="margin-left: 10px">{{ recipe.ingredients }}</p>
    </div>
    <br />
    <div style="display: flex">
      <p class="lead" style="color: #ccc">Instructions:</p>
      <p class="lead" style="margin-left: 10px">{{ recipe.instructions }}</p>
    </div>
  </div>

  <br />

  {% if recipe.parent %}
  <a
    href="{% url 'detail' recipe.parent %}"
    class="btn btn-primary btn-lg btn-block btn-dark"
    >Original Recipe</a
  >
  {% endif %}

  <div class="row">
    <a
      class="btn btn-primary btn-dark"
      href="{% url 'fork_recipe_list' recipe.id %}"
      >View Recipe Variations</a
    >

    <!-- Save Button -->
  <form action="{% url 'like_recipe' recipe.id %}" method="POST">
    {% csrf_token %} {% if user.is_authenticated %} {% if liked %}
    <button
      type="submit"
      class="btn btn-primary btn-dark"
      name="recipe_id"
      value="{{ recipe.id}}"
    >
      Unsave Recipe
    </button>
    {% else %}
    <button
      type="submit"
      class="btn btn-primary btn-dark"
      name="recipe_id"
      value="{{ recipe.id}}"
    >
      Save Recipe
    </button>
    {% endif %} {% endif %}
  </form>

  <!-- Fork Buttons -->
  <form action="{% url 'fork' recipe.id %}" method="POST">
    {% csrf_token %} {% if user.is_authenticated %}
    <button
      type="submit"
      name="recipe_id"
      value="{{ recipe.id}}"
      class="btn btn-primary btn-dark"
    >
      Fork Recipe
    </button>
    {% endif %}
  </form>

  </div>
  <br />

  <div
    class="btn-group text-right"
    role="group"
    aria-label="Button group example"
  >
    <!-- Edit/Delete Buttons -->
    {% if user.is_authenticated and object.added_by == user%}
    <a class="btn btn-primary btn-dark" href="edit" role="button">Edit</a>
    <a href="{% url 'delete' recipe.id %}" class="btn btn-danger btn-primary"
      >Delete</a
    >
    {% endif %}
  </div>

  <div style="display: flex">
  <h4 >Comments</h4>
    {% if user.is_authenticated %}
    <a type="button" class="btn btn-sm btn-info"  href="{% url 'add_comment' recipe.id %}" style="margin-left: 8px; height: 32px"
      >+ Add a comment</a
    >
    {% endif %}
  </div>
  

  <br>
  
  {% if not recipe.comments.all %}
  <i class="lead rating-desc" style="color: #ccc">No comments yet</i>
  {% else %}
  
  {% for comment in recipe.comments.all %}
  <div class="comment">
    <strong> {{ comment.name }} - {{ comment.date_added }} </strong>
    <br />
    {{ comment.body }}
  </div>
  <br />
  
  {% endfor %} {% endif %}
  {% endblock content %}
</body>
